@model List<BIrthday.Models.StoryChapter>

 @{
    ViewData["Title"] = "Story";
}
<section class="story-section reveal">
    <h1>A small journey begins</h1>
    <p> Just a tiny story, About you obviously</p>
</section>



<section id="book-chapter">
    <div class="book-shell">
        <div class="book-shell-platfrom"></div>
        <div class="book">
            <div class="book-shape">
                <div class="book-inner">
                    <div class="page">
                        <h2 id="chapter-title"></h2>
                        <p id="chapter-body"></p>
                        <div class="nav-links" style="margin-top:24px;">
                            <a href="#" id="prevBtn" class="begin-link" style="display:none;">⬅️ Go back</a>
                            <a href="#" id="nextBtn" class="begin-link">Turn the page ➡️</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <audio id="technoAudio" src="/audio/technoAudio.MP3"></audio>
</section>

<script>

    document.addEventListener("DOMContentLoaded", () =>{
    const chapters= @Html.Raw(
        System.Text.Json.JsonSerializer.Serialize(Model)
    );
    let index=0;
    const titleE1 = document.getElementById("chapter-title");
    const bodyE1 = document.getElementById("chapter-body");

    const nextBtn=document.getElementById("nextBtn");
    const prevBtn=document.getElementById("prevBtn");
    // const beginbtn = document.getElementById("beginBook");
    // const introSections= document.querySelectorAll(".story-section:not(#book-chapter)");
    const bookSection=document.getElementById("book-chapter");
    const shadow = document.querySelector(".book-shadow");

    const page=document.querySelector(".page");

    let index=0;
        const titleEl = document.getElementById("chapter-title");
        const bodyEl = document.getElementById("chapter-body");
        const nextBtn = document.getElementById("nextBtn");
        const prevBtn = document.getElementById("prevBtn");
        const bookSection = document.getElementById("book-chapter");
        const page = document.querySelector(".page");
    function renderChapter(){
            const chapter= chapters[index];

    titleEl.textContent= chapter.Title;
    bodyEl.innerHTML = chapter.Body.replace(/\n/g, "<br><br>");

        //mood 
        document.body.dataset.mood=chapter.Mood||"cozy";

        titleE1.textContent= chapters[index].Title;
        bodyE1.innerHTML = chapters[index].Body.replace(/\n/g, "<br><br>");
        // mood for css
        doucment.body.dataset.mood= chapter.Mood || "cozy";

        const isFirst=index==0;
        const isLast=chapter.isFinal || index=== chapters.length-1;

        if (isLastMain){
                nextBtn.textContent="Play the surprise ";
                nextBtn.classList.add("final-cta");
        }
        else{
                nextBtn.textContent="Turn the page ➡️";  

        if(isLast){
            nextBtn.textContent= "Play the surprise ✨";
        }else{
            nextBtn.textContent="Turn the page ➡️";
        }
        nextBtn.style.display="inline-block";
    }
        nextBtn.onclick = e => {
        e.preventDefault();
        const chapter=chapters[index];
            const isLast=chapter.isFinal || index === chapters.length - 1;

        if (isLast) {
            const audio= document.getElementById("technoAudio");
            audio?.play();
            page.classList.add("glow");
            return;   
        }
        if (index<chapters.length-1){
            page.classList.remove("flip-back");
            page.classList.add("flip");
            setTimeout(() => {
                index++;
                renderChapter();
                page.classList.remove("flip");
            }, 600);    
                

        }
    };

    prevBtn.onclick = e => {
        e.preventDefault();
        if (index > 0) {
            page.classList.remove("flip");
            page.classList.add("flip-back");

            setTimeout(() => {
                index--;
                renderChapter();
                page.classList.remove("flip-back");
            }, 600);
        }
    };

    
    renderChapter();
      bookSection.scrollIntoView({behavior:"smooth", block: "center"});

    });
</script>
   