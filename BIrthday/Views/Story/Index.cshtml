@model List<BIrthday.Models.StoryChapter>

 @{
    ViewData["Title"] = "Story";
}
<section class="story-section reveal">
    <h1>A small journey begins</h1>
    <p>This was made just for you (also for my learning purposes 🥹).</p>
</section>

<section id="book-chapter">
    <div class="book">
        <div class="page">
            <h2 id="chapter-title"></h2>
            <p id="chapter-body"></p>
            <div class="nav-links" style="margin-top:24px;">
                <a href="#" id="prevBtn" class="begin-link" style="display:none;">⬅️ Go back</a>
                <a href="#" id="nextBtn" class="begin-link">Turn the page ➡️</a>
            </div>
        </div>
    </div>
    <audio id="technoAudio" src="/audio/technoblade-birthday.mp3"></audio>
</section>
<script>
    document.addEventListener("DOMContentLoaded", () =>{
    const chapters= @Html.Raw(
        System.Text.Json.JsonSerializer.Serialize(Model)
    );

    let index=0;
        const titleEl = document.getElementById("chapter-title");
        const bodyEl = document.getElementById("chapter-body");
        const nextBtn = document.getElementById("nextBtn");
        const prevBtn = document.getElementById("prevBtn");
        const bookSection = document.getElementById("book-chapter");
        const page = document.querySelector(".page");
    function renderChapter(){
            const chapter= chapters[index];

    titleEl.textContent= chapter.Title;
    bodyEl.innerHTML = chapter.Body.replace(/\n/g, "<br><br>");

        //mood 
        document.body.dataset.mood=chapter.Mood||"cozy";

        const isFirst= index ===0;
        const isLastMain= chapter.isFinal|| index === chapters.length -1;

        // prev visibitlity
        prevBtn.style.display= isFirst?"none": "inline-block";

        if (isLastMain){
                nextBtn.textContent="Play the surprise ";
        }
        else{
                nextBtn.textContent="Turn the page ➡️";  

        }
        nextBtn.style.display = "inline-block";
    }


        nextBtn.onclick = e => {
        e.preventDefault();

        const chapter = chapters[index];
        const isLastMain = chapter.isFinal || index === chapters.length - 1;

        if (isLastMain) {
            const audio = document.getElementById("technoAudio");
            if (audio) audio.play();
            page.classList.add("glow");
            setTimeout(() => {
                page.classList.remove("glow");
            }, 4000);
            return;
        }

        if (index < chapters.length - 1) {
            page.classList.remove("flip-back");
            page.classList.add("flip");

            setTimeout(() => {
                index++;
                renderChapter();
                page.classList.remove("flip");
            }, 600);
        }
    };

    prevBtn.onclick = e => {
        e.preventDefault();
        if (index > 0) {
            page.classList.remove("flip");
            page.classList.add("flip-back");

            setTimeout(() => {
                index--;
                renderChapter();
                page.classList.remove("flip-back");
            }, 600);
        }
    };

    // beginbtn.onclick = (e) => {
    //     e.preventDefault();
    //     hide intro sections
    //     introSections.forEach(s => s.style.display = "none");
    //     bookSection.style.display = "block";
    //     renderChapter();
    // };
    
    renderChapter();
      bookSection.scrollIntoView({behavior:"smooth", block: "center"});

    });
</script>
